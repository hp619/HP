<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Registration</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: #f0f2f5; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px; 
        }
        .card { 
            width: 100%; 
            max-width: 450px; 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 20px; font-size: 26px; }
        
        .form-group { margin-bottom: 15px; }
        label { font-size: 13px; color: #555; font-weight: 600; display: block; margin-bottom: 5px; }
        
        input, textarea { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #eee; 
            border-radius: 10px; 
            font-size: 15px; 
            outline: none;
            transition: 0.3s;
        }
        input:focus, textarea:focus { border-color: #1a73e8; background: #f8fbff; }
        
        button { 
            width: 100%; 
            padding: 14px; 
            background: #27ae60; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 16px;
            font-weight: bold; 
            margin-top: 10px; 
            transition: 0.3s;
        }
        button:hover { background: #219150; transform: translateY(-1px); }
        
        .gps-btn { 
            background: #1a73e8; 
            margin-bottom: 5px; 
            font-size: 14px; 
            padding: 10px; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .gps-btn:hover { background: #1557b0; }
        
        .gps-status { font-size: 12px; color: #2ecc71; text-align: center; display: block; margin-bottom: 15px; min-height: 15px; }
        .pass-hint { font-size: 11px; color: #d93025; display: block; margin-top: 5px; line-height: 1.3; }
        
        #otp-box { 
            display:none; 
            padding: 15px; 
            background: #eafff2; 
            border: 2px dashed #27ae60; 
            border-radius: 10px;
            margin: 15px 0; 
        }

        @media (max-width: 480px) {
            .card { padding: 20px; }
            h2 { font-size: 22px; }
        }
    </style>
</head>
<body>

<div class="card">
    <h2>Hospital Register</h2>
    <form id="hForm">
        <input type="hidden" id="h_lat" name="lat">
        <input type="hidden" id="h_lng" name="lng">

        <div class="form-group">
            <input type="text" id="h_name" placeholder="Hospital Name" required>
        </div>
        
        <div class="form-group">
            <label for="h_date">Establishment Date</label>
            <input type="date" id="h_date" required>
        </div>
        
        <div class="form-group">
            <textarea id="h_address" placeholder="Hospital Full Address" rows="2" required></textarea>
        </div>

        <button type="button" class="gps-btn" onclick="getLocation()">üìç Detect Location (GPS)</button>
        <span id="location-msg" class="gps-status"></span>

        <div class="form-group">
            <input type="text" id="h_phone" placeholder="Phone Number">
        </div>

        <div class="form-group">
            <input type="password" id="pass" placeholder="Create Password" required>
            <span class="pass-hint">Min 8 chars, 1 Number & 1 Symbol (@#$%^&*)</span>
        </div>

        <div class="form-group">
            <input type="password" id="c_pass" placeholder="Confirm Password" required>
        </div>

        <div class="form-group">
            <input type="email" id="email" placeholder="Official Email Address" required>
        </div>

        <div id="otp-box">
            <span style="font-size:12px; font-weight:bold; color:#27ae60; display:block; margin-bottom:5px;">EMAIL VERIFICATION CODE</span>
            <input type="text" id="otp_code" placeholder="Enter OTP Here">
        </div>

        <button type="button" id="btn" onclick="handle()">Send OTP</button>
    </form>
</div>

<script>
let step = 1;

function getLocation() {
    const msg = document.getElementById('location-msg');
    if (navigator.geolocation) {
        msg.innerText = "Finding location...";
        navigator.geolocation.getCurrentPosition((position) => {
            document.getElementById('h_lat').value = position.coords.latitude;
            document.getElementById('h_lng').value = position.coords.longitude;
            msg.innerText = "‚úÖ Location Captured Successfully!";
            msg.style.color = "green";
        }, (error) => {
            msg.innerText = "‚ùå Error: Please allow location access.";
            msg.style.color = "red";
            alert("Location access denied!");
        });
    } else {
        alert("Aapka browser GPS support nahi karta.");
    }
}

window.onload = getLocation;

function isStrongPassword(password) {
    const minLength = 8;
    const hasNumber = /\d/;
    const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/;
    if (password.length < minLength) return "Password kam se kam 8 characters ka hona chahiye!";
    if (!hasNumber.test(password)) return "Password mein ek number hona chahiye!";
    if (!hasSpecialChar.test(password)) return "Password mein ek special character hona chahiye!";
    return true;
}

function handle() {
    const p1 = document.getElementById('pass').value;
    const p2 = document.getElementById('c_pass').value;
    const email = document.getElementById('email').value;
    const hDate = document.getElementById('h_date').value;
    const hName = document.getElementById('h_name').value;
    const hAddress = document.getElementById('h_address').value;
    const hLat = document.getElementById('h_lat').value; 
    const hLng = document.getElementById('h_lng').value;
    const hPhone = document.getElementById('h_phone').value;

    if(step === 1) {
        if(!hName || !hDate || !email || !hAddress) { alert("Details bharna zaroori hai!"); return; }
        if(p1 !== p2) { alert("Passwords match nahi ho rahe!"); return; }
        const strengthCheck = isStrongPassword(p1);
        if(strengthCheck !== true) { alert(strengthCheck); return; }

        fetch('/send-otp-only', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                email: email, 
                password: p1, 
                confirm_password: p2,
                role: 'hospital', 
                hospital_name: hName,
                address: hAddress,
                establishment_date: hDate,
                lat: hLat ? parseFloat(hLat) : null, 
                lng: hLng ? parseFloat(hLng) : null  
            })
        }).then(res => {
            if(res.ok) {
                document.getElementById('otp-box').style.display = 'block';
                document.getElementById('btn').innerText = 'Verify & Register';
                step = 2;
                alert("OTP bhej diya gaya hai!");
            } else {
                alert("Server error!");
            }
        });
    } else {
        fetch('/verify-and-register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                otp: document.getElementById('otp_code').value,
                email: email,
                password: p1,
                role: 'hospital',
                hospital_name: hName,
                address: hAddress,
                establishment_date: hDate,
                phone: hPhone,
                lat: hLat ? parseFloat(hLat) : null,
                lng: hLng ? parseFloat(hLng) : null
            })
        }).then(res => res.ok ? window.location.href='/login' : alert("Galat OTP!"));
    }
}
</script>
</body>
</html>
